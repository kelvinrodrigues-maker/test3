<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat√≥rio de Constata√ß√£o ‚Äì GeoGIS</title>

<link rel="manifest" href="manifest.json">

<style>
body {
    font-family: Arial, Helvetica, sans-serif;
    background: #f2f2f2;
    padding: 15px;
    margin: 0;
}
.container {
    max-width: 900px;
    margin: auto;
    background: #ffffff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 12px rgba(0,0,0,.12);
}
.header {
    text-align: center;
    margin-bottom: 20px;
}
.header img {
    max-width: 260px;
    width: 100%;
    height: auto;
    margin-bottom: 10px;
}
.header h1 {
    font-size: 22px;
    margin: 5px 0;
}
.header p {
    font-size: 14px;
    color: #555;
}
label {
    font-weight: bold;
    margin-top: 10px;
    display: block;
}
input, textarea, select, button {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
}
textarea {
    resize: vertical;
}
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
}
.hidden {
    display: none;
}
pre {
    background: #f9f9f9;
    border: 1px solid #ccc;
    padding: 12px;
    white-space: pre-wrap;
    margin-top: 15px;
}
button {
    background: #1f3c88;
    color: #fff;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    margin-top: 12px;
    cursor: pointer;
}
button.secondary {
    background: #555;
}
.photos img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    margin: 5px;
    border-radius: 5px;
    border: 1px solid #aaa;
}
canvas {
    border: 1px solid #000;
    width: 100%;
    height: 160px;
    margin-top: 5px;
}
hr {
    margin: 20px 0;
}
</style>
</head>

<body>

<div class="container">

<!-- LOGO -->
<div class="header">
    <img src="logo.png" alt="GeoGIS">
    <h1>Relat√≥rio de Constata√ß√£o de Posse</h1>
    <p>Sistema de Vistoria T√©cnica ‚Äì Uso Offline</p>
</div>

<label>Tipo de Relat√≥rio</label>
<select id="tipo" onchange="alternar()">
    <option value="contato">Constata√ß√£o COM Contato</option>
    <option value="sem">Constata√ß√£o SEM Contato</option>
</select>

<hr>

<h2>Dados do Lote</h2>
<div class="grid">
    <input id="requerente" placeholder="Nome da Requerente">
    <input id="cidade" placeholder="Cidade">
    <input id="bairro" placeholder="Bairro">
    <input id="quadra" placeholder="Quadra">
    <input id="lote" placeholder="Lote">
</div>

<!-- COM CONTATO -->
<div id="contato">
<hr>
<h2>Dados Financeiros e do Im√≥vel</h2>
<div class="grid">
    <input id="rendaBruta" placeholder="Renda Bruta (R$)">
    <input id="rendaFamiliar" placeholder="Renda Familiar (R$)">
    <input id="comodos" placeholder="N¬∫ de C√¥modos">
    <input id="banheiros" placeholder="N¬∫ de Banheiros">
</div>
<label>Observa√ß√£o</label>
<textarea id="obsContato"></textarea>
</div>

<!-- SEM CONTATO -->
<div id="sem" class="hidden">
<hr>
<h2>Ocorr√™ncia ‚Äì Sem Contato</h2>
<label>Observa√ß√£o</label>
<textarea id="obsSem"></textarea>
</div>

<hr>

<h2>Localiza√ß√£o</h2>
<button onclick="capturarGPS()">üìç Capturar Localiza√ß√£o</button>
<p id="gps"></p>

<hr>

<h2>Registro Fotogr√°fico</h2>
<input type="file" multiple accept="image/*" capture="environment" onchange="addFotos(this)">
<div class="photos" id="preview"></div>

<hr>

<h2>Assinatura Digital</h2>
<canvas id="assinatura"></canvas>
<button class="secondary" onclick="limparAssinatura()">Limpar Assinatura</button>

<hr>

<h2>Entrevistador</h2>
<div class="grid">
    <input id="entrevistador" placeholder="Nome do Entrevistador">
    <input type="date" id="data">
</div>

<button onclick="gerar()">Gerar Relat√≥rio</button>
<button onclick="salvar()">üíæ Salvar Offline</button>
<button onclick="compartilhar()">üì§ Compartilhar Texto + Fotos</button>

<pre id="saida"></pre>

</div>

<script>
let fotos = [];
let gpsTexto = '';

function alternar() {
    const tipoSelecionado = document.getElementById('tipo').value;
    const blocoContato = document.getElementById('contato');
    const blocoSemContato = document.getElementById('sem');

    if (tipoSelecionado === 'contato') {
        blocoContato.classList.remove('hidden');
        blocoSemContato.classList.add('hidden');
    } else {
        blocoContato.classList.add('hidden');
        blocoSemContato.classList.remove('hidden');
    }
}

document.addEventListener('DOMContentLoaded', alternar);

function capturarGPS() {
    navigator.geolocation.getCurrentPosition(pos => {
        gpsTexto = `Latitude: ${pos.coords.latitude}, Longitude: ${pos.coords.longitude}`;
        document.getElementById('gps').innerText = gpsTexto;
    }, () => alert('N√£o foi poss√≠vel obter a localiza√ß√£o'));
}

function addFotos(input) {
    [...input.files].forEach(file => {
        fotos.push(file);
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        preview.appendChild(img);
    });
}

function gerar() {
    let texto = `
Requerente: ${requerente.value}
Cidade: ${cidade.value}
Bairro: ${bairro.value}
Quadra: ${quadra.value}
Lote: ${lote.value}

Localiza√ß√£o: ${gpsTexto}
`;

    if (tipo.value === 'contato') {
        texto += `
Renda Bruta: ${rendaBruta.value}
Renda Familiar: ${rendaFamiliar.value}
N¬∫ de C√¥modos: ${comodos.value}
N¬∫ de Banheiros: ${banheiros.value}
Observa√ß√£o: ${obsContato.value}
`;
    } else {
        texto += `
Observa√ß√£o: ${obsSem.value}
`;
    }

    texto += `
Entrevistador: ${entrevistador.value}
Data: ${data.value}

Registro fotogr√°fico e assinatura em anexo.
`;

    saida.textContent = texto.trim();
}

function salvar() {
    const lista = JSON.parse(localStorage.getItem('relatorios') || '[]');
    lista.push(saida.textContent);
    localStorage.setItem('relatorios', JSON.stringify(lista));
    alert('Relat√≥rio salvo offline com sucesso');
}

async function compartilhar() {
    if (!navigator.share) {
        alert('Compartilhamento n√£o suportado neste dispositivo');
        return;
    }
    await navigator.share({
        title: 'Relat√≥rio de Constata√ß√£o ‚Äì GeoGIS',
        text: saida.textContent,
        files: fotos
    });
}

/* Assinatura */
const canvas = document.getElementById('assinatura');
const ctx = canvas.getContext('2d');
let desenhando = false;

canvas.addEventListener('mousedown', () => desenhando = true);
canvas.addEventListener('mouseup', () => desenhando = false);
canvas.addEventListener('mousemove', e => {
    if (!desenhando) return;
    ctx.lineWidth = 2;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
});

function limparAssinatura() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}
</script>

</body>
</html>
