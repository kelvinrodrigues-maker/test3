<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat칩rio de Constata칞칚o</title>

<link rel="manifest" href="manifest.json">

<style>
body { font-family: Arial; background:#f2f2f2; padding:15px; }
.container { background:#fff; padding:20px; max-width:900px; margin:auto; border-radius:8px; }
label { font-weight:bold; margin-top:10px; display:block; }
input, textarea, select, button { width:100%; padding:8px; margin-top:4px; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:10px; }
.hidden { display:none; }
pre { background:#f9f9f9; padding:10px; white-space:pre-wrap; }
canvas { border:1px solid #000; width:100%; height:150px; }
button { background:#1f3c88; color:#fff; border:none; padding:10px; margin-top:10px; }
.photos img { width:100px; height:100px; object-fit:cover; margin:5px; }
</style>
</head>

<body>
<div class="container">
<h1>Relat칩rio de Constata칞칚o</h1>

<label>Tipo de Relat칩rio</label>
<select id="tipo" onchange="alternar()">
<option value="contato">Com Contato</option>
<option value="sem">Sem Contato</option>
</select>

<h2>Dados do Lote</h2>
<div class="grid">
<input id="requerente" placeholder="Requerente">
<input id="cidade" placeholder="Cidade">
<input id="bairro" placeholder="Bairro">
<input id="quadra" placeholder="Quadra">
<input id="lote" placeholder="Lote">
</div>

<div id="contato">
<h2>Dados Financeiros e Im칩vel</h2>
<div class="grid">
<input id="rendaBruta" placeholder="Renda Bruta">
<input id="rendaFam" placeholder="Renda Familiar">
<input id="comodos" placeholder="N췈 de C칪modos">
<input id="banheiros" placeholder="N췈 de Banheiros">
</div>
<label>Observa칞칚o</label>
<textarea id="obsContato"></textarea>
</div>

<div id="sem" class="hidden">
<h2>Ocorr칡ncia</h2>
<label>Observa칞칚o</label>
<textarea id="obsSem"></textarea>
</div>

<h2>Localiza칞칚o</h2>
<button onclick="obterLocal()">游늸 Capturar Localiza칞칚o</button>
<p id="gps"></p>

<h2>Fotos</h2>
<input type="file" multiple accept="image/*" capture onchange="addFotos(this)">
<div class="photos" id="preview"></div>

<h2>Assinatura</h2>
<canvas id="assinatura"></canvas>
<button onclick="limparAss()">Limpar Assinatura</button>

<h2>Entrevistador</h2>
<div class="grid">
<input id="entrevistador" placeholder="Nome">
<input type="date" id="data">
</div>

<button onclick="gerar()">Gerar Relat칩rio</button>
<button onclick="salvar()">游 Salvar Offline</button>
<button onclick="compartilhar()">游닋 Compartilhar</button>

<pre id="saida"></pre>
</div>

<script>
let fotos = [];
let gps = '';

function alternar(){
document.getElementById('contato').classList.toggle('hidden',tipo.value!=='contato');
document.getElementById('sem').classList.toggle('hidden',tipo.value!=='sem');
}

function obterLocal(){
navigator.geolocation.getCurrentPosition(p=>{
gps = `Lat: ${p.coords.latitude}, Lng: ${p.coords.longitude}`;
document.getElementById('gps').innerText = gps;
});
}

function addFotos(i){
[...i.files].forEach(f=>{
fotos.push(f);
let img=document.createElement('img');
img.src=URL.createObjectURL(f);
preview.appendChild(img);
});
}

function gerar(){
let t=`
Requerente: ${requerente.value}
Cidade: ${cidade.value}
Bairro: ${bairro.value}
Quadra: ${quadra.value}
Lote: ${lote.value}

Localiza칞칚o: ${gps}

`;
if(tipo.value==='contato'){
t+=`
Renda Bruta: ${rendaBruta.value}
Renda Familiar: ${rendaFam.value}
C칪modos: ${comodos.value}
Banheiros: ${banheiros.value}
Observa칞칚o: ${obsContato.value}
`;
}else{
t+=`
Observa칞칚o: ${obsSem.value}
`;
}
t+=`
Entrevistador: ${entrevistador.value}
Data: ${data.value}
`;
saida.textContent=t.trim();
}

function salvar(){
let lista=JSON.parse(localStorage.getItem('relatorios')||'[]');
lista.push(saida.textContent);
localStorage.setItem('relatorios',JSON.stringify(lista));
alert('Relat칩rio salvo offline');
}

async function compartilhar(){
if(!navigator.share) return alert('Compartilhamento n칚o suportado');
await navigator.share({ text: saida.textContent, files: fotos });
}

function limparAss(){ctx.clearRect(0,0,c.width,c.height);}
</script>
</body>
</html>
